{{ define "main" }}
    {{ $headerHeight :=  "85px" }}{{ $headerHeight }}
    <div id="documentationPage" class="flex ">
        <div
            id="documentation_aside"
            style="height: calc(100vh - {{ $headerHeight }}); top: {{ $headerHeight }};"
            class="flex-1 z-10 overflow-y-auto hidden xl:flex flex-col sticky bg-white  w-80"
        >
            <div class="w-60  pt-10 h-full flex flex-col border-r border-gray-200">
                <div class="text-sm font-bold mb-5 uppercase">Documentation</div>
                {{ .Scratch.Set "currentPage" .Title }}
                {{ range .Site.Menus.documentation.ByWeight }}
                    <a
                        href="{{ .URL }}"
                        title="{{ .Title }}"
                        class="inline-flex items-center py-2  text-base font-medium rounded-md text-gray-900  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"
                    >
                        {{ if ne .Params.svg nil }}
                            <div class="{{ .Params.class }} w-6 h-6 mr-1">
                                {{ partial (printf "svg/%s.svg" .Params.svg) }}
                            </div>
                            {{ else }}
                            <div class="{{ .Params.class }} text-brand-400 w-6 h-6 mr-1">
                                {{ partial "svg/documentation.svg" }}
                            </div>
                        {{ end }}
                        <span class="truncate">{{- .Name -}}</span>
                    </a>
                {{ end }}
            </div>
        </div>

        <!-- Content -->
        <div class="mx-auto text-base my-24">
            <div class="reading">
                <p
                    class="text-base font-semibold leading-6 tracking-wide text-indigo-600 uppercase"
                >
                    {{ .Params.tag }}
                </p>
                <h1
                    class="mb-8 text-4xl font-extrabold  tracking-tight text-gray-900 sm:text-5xl  sm:leading-none"
                >
                    {{ .Title }}
                </h1>
                <div class="prose prose-lg sm:prose-xl text-gray-800 mx-auto">
                    {{ .Content }}
                </div>
            </div>
            <div class="h-24 bg-green-600 flex justify-between mt-10">
                {{ with .Site.RegularPages.Prev . }}
                    <a class="button" href="{{ .RelPermalink }}">{{ . }}</a>
                {{ end }}
                {{ with .Site.RegularPages.Next . }}
                    <a class="button" href="{{ .RelPermalink }}">{{ . }}</a>
                {{ end }}
            </div>
        </div>

        <!-- ToC -->
        {{ if eq .Page.Title ($.Scratch.Get "currentPage") }}
            <div
                id="documentation_toc"
                style="height: calc(100vh - {{ $headerHeight }}); top: {{ $headerHeight }};"
                class="flex-1 z-10 overflow-y-auto hidden lg:flex flex-col sticky bg-white  w-80 "
            >
                <div class="pt-10 h-full border-l border-gray-200 ml-10 px-5 text-brand-700 w-80">
                    {{ if ne false .Params.toc }}
                        <div class="text-sm font-bold mb-5 uppercase">Dans cette page</div>
                        {{ .Page.TableOfContents }}
                    {{ end }}
                </div>
            </div>
        {{ end }}
    </div>
{{ end }}

{{ define "script" }}
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            var options = {
                // root: document.querySelector("#contentArea"),
                rootMargin: "0px 0px 0px 0px",
                // threshold: 0.5,
            }
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    const id = entry.target.getAttribute("id")
                    if (entry.isIntersecting) {
                        document
                            .querySelector(`nav#TableOfContents ul li a[href="#${id}"]`)
                            .classList.add("active")
                    } else {
                        document
                            .querySelector(`nav#TableOfContents ul li a[href="#${id}"]`)
                            .classList.remove("active")
                    }
                })
            }, options)

            // Track all sections that have an `id` applied
            document.querySelectorAll("h2[id]").forEach((section) => {
                observer.observe(section)
            })
            document.querySelectorAll("h3[id]").forEach((section) => {
                observer.observe(section)
            })
        })
    </script>
{{ end }}

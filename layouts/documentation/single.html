{{ define "main" }}
    {{ $headerHeight :=  "85px" }}
    <div id="documentationPage" class="flex ">
        <div
            id="documentation_aside"
            style="height: calc(100vh - {{ $headerHeight }}); top: {{ $headerHeight }};"
            class="flex z-10 overflow-y-auto hidden lg:flex flex-col sticky bg-white"
        >
            <div class="w-80 pt-10 h-full flex flex-col border-r border-gray-200">
                <div class="text-sm font-bold mb-5 uppercase pl-12">Documentation</div>

                {{ $currentPage := . }}

                {{ range .Site.Menus.documentation.ByWeight }}
                    <a
                        href="{{ .URL }}"
                        title="{{ .Title }}"
                        class="{{ if $currentPage.IsMenuCurrent "documentation" . }}bg-brand-300{{ end }} pl-5 inline-flex items-center py-2  text-base font-medium rounded-l-md text-brand-900  hover:bg-brand-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 "
                    >
                        {{ if ne .Params.svg nil }}
                            <div class="{{ .Params.class }} w-6 h-6 mr-1">
                                {{ partial (printf "svg/%s.svg" .Params.svg) }}
                            </div>
                            {{ else }}
                            <div class="{{ .Params.class }} text-brand-400 w-6 h-6 mr-1">
                                {{ partial "svg/documentation.svg" }}
                            </div>
                        {{ end }}
                        <span class="truncate">{{- .Name -}}</span>
                    </a>
                {{ end }}
            </div>
        </div>

        <!-- Content -->
        <div class="bg-brand-100 flex-1 flex-col text-base py-24 lg:px-10 max-w-full">
            <div class="reading mx-auto  lg:max-w-xl xl:max-w-4xl 2xl:max-w-5xl">
                <p
                    class="text-base font-semibold leading-6 tracking-wide text-indigo-600 uppercase"
                >
                    {{ .Params.tag }}
                </p>
                <h1
                    class="mb-8 text-4xl font-extrabold  tracking-tight text-gray-900 sm:text-5xl  sm:leading-none"
                >
                    {{ .Title }}
                </h1>
                <div class=" prose prose-lg sm:prose-xl text-gray-800 mx-auto">
                    {{ .Content }}
                </div>
            </div>
            <div class=" bg-brand-200 flex justify-between mt-10">
                {{ with .Site.RegularPages.Prev . }}
                    <a class="button" href="{{ .RelPermalink }}">
                        {{ partial "svg/chevron-left.svg" . }}
                        {{ .Name }}
                    </a>
                {{ end }}
                {{ with .Site.RegularPages.Next . }}
                    <a class="button" href="{{ .RelPermalink }}">
                        {{ .Name }}
                        {{ partial "svg/chevron-right.svg" . }}
                    </a>
                {{ end }}
            </div>
        </div>

        <!-- ToC -->

        <div
            id="documentation_toc"
            style="height: calc(100vh - {{ $headerHeight }}); top: {{ $headerHeight }};"
            class="flex z-10 overflow-x-hidden hidden lg:flex flex-col sticky bg-white"
        >
            <div class="pt-10 w-80 h-full border-l border-gray-200 px-5 text-brand-700">
                {{ if ne false .Params.toc }}
                    <div class="text-sm font-bold mb-5 uppercase">Dans cette page</div>
                    {{ .Page.TableOfContents }}
                {{ end }}
            </div>
        </div>
    </div>
{{ end }}

{{ define "script" }}
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            var options = {
                // root: document.querySelector("#contentArea"),
                rootMargin: "0px 0px 0px 0px",
                // threshold: 0.5,
            }
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    const id = entry.target.getAttribute("id")
                    if (entry.isIntersecting) {
                        document
                            .querySelector(`nav#TableOfContents ul li a[href="#${id}"]`)
                            .classList.add("active")
                    } else {
                        document
                            .querySelector(`nav#TableOfContents ul li a[href="#${id}"]`)
                            .classList.remove("active")
                    }
                })
            }, options)

            // Track all sections that have an `id` applied
            document.querySelectorAll("h2[id]").forEach((section) => {
                observer.observe(section)
            })
            document.querySelectorAll("h3[id]").forEach((section) => {
                observer.observe(section)
            })
        })
    </script>
{{ end }}

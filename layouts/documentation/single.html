{{ define "main" }}
    <main class="max-w-screen-xl mx-auto pb-10">
        <div class="lg:grid lg:grid-cols-12 ">
            <div class="lg:hidden py-2">
                <label for="tabs" class="sr-only">Select a tab</label>
                <select
                    id="tabs"
                    name="tabs"
                    onchange="location = this.value;"
                    class="block w-full   cursor-pointer focus:ring-indigo-500 focus:border-indigo-500 border-gray-300 rounded-md"
                >
                    {{ range .Site.Menus.documentation.ByWeight }}
                        <option value="{{ .URL }}">
                            <span class="truncate">{{- .Name -}}</span>
                        </option>
                    {{ end }}
                </select>
            </div>
            <aside
                style="height:calc(100% - 120px);"
                class="hidden mb-2 py-3 -mx-2 px-2 lg:flex  flex-col fixed h-full bg-white  w-80 overflow-y-auto lg:col-span-3"
            >
                {{ .Scratch.Set "currentPage" .Title }}
                {{ range .Site.Menus.documentation.ByWeight }}
                    <a href="{{ .URL }}" title="{{ .Title }}" class="menu">
                        {{ if ne .Params.svg nil }}
                            <div class="{{ .Params.class }} w-6 h-6 mr-1">
                                {{ partial (printf "svg/%s.svg" .Params.svg) }}
                            </div>
                            {{ else }}
                            <div class="{{ .Params.class }} text-brand-400 w-6 h-6 mr-1">
                                {{ partial "svg/documentation.svg" }}
                            </div>
                        {{ end }}
                        <span class="truncate">{{- .Name -}}</span>
                    </a>
                    {{ if eq .Page.Title ($.Scratch.Get "currentPage") }}
                        <div class="ml-3 pl-4 border-l border-gray-200">
                            {{ .Page.TableOfContents }}
                        </div>
                    {{ end }}
                {{ end }}
            </aside>

            <!-- Content -->
            <div class="lg:ml-80 float-left w-full px-5  lg:col-span-9">
                <section class="mx-auto">
                    <div class="mx-auto text-base">
                        <p
                            class="text-base font-semibold leading-6 tracking-wide text-indigo-600 uppercase"
                        >
                            {{ .Params.tag }}
                        </p>
                        <h1
                            class="mb-8 text-4xl font-extrabold leading-8 tracking-tight text-gray-900 sm:text-5xl sm:leading-none"
                        >
                            {{ .Title }}
                        </h1>
                    </div>
                    <div class="prose prose-lg sm:prose-xl text-gray-800">
                        {{ .Content }}
                    </div>
                </section>
            </div>
        </div>
    </main>
{{ end }}

{{ define "script" }}
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            var options = {
                // root: document.querySelector("#contentArea"),
                rootMargin: "0px 0px 0px 0px",
                // threshold: 0.5,
            }
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    const id = entry.target.getAttribute("id")
                    if (entry.isIntersecting) {
                        document
                            .querySelector(`nav#TableOfContents ul li a[href="#${id}"]`)
                            .classList.add("active")
                    } else {
                        document
                            .querySelector(`nav#TableOfContents ul li a[href="#${id}"]`)
                            .classList.remove("active")
                    }
                })
            }, options)

            // Track all sections that have an `id` applied
            document.querySelectorAll("h2[id]").forEach((section) => {
                observer.observe(section)
            })
            document.querySelectorAll("h3[id]").forEach((section) => {
                observer.observe(section)
            })
        })
    </script>
{{ end }}
